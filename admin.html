<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yönetim Paneli</title>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Space+Grotesk:wght@500;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Quill Editor CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    
    <!-- Sortable JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>

    <!-- Stil Dosyaları -->
    <link rel="stylesheet" href="admin.css"> 
    <link rel="stylesheet" href="tools.css"> 

    <script>
    // Hızlı Yetki Kontrolü
    (function() {
        const isAdmin = localStorage.getItem('isAdmin');
        if (isAdmin !== 'true') {
            window.location.href = "login.html"; 
        }
    })();
    </script>
</head>
<body>

    <div id="toast-container"></div>

    <div class="admin-container">

        <!-- SIDEBAR -->
        <aside class="admin-sidebar glass">
            <div class="sidebar-header">
                <!-- Buradaki 'Admin' marka adıdır, dilerseniz değiştirebilirsiniz -->
                <h2>Panel<span class="dot">.</span></h2>
                <button class="sidebar-close-btn hidden-lg"><i class="fa-solid fa-xmark"></i></button>
            </div>

            <ul class="admin-menu">
                <li class="active" onclick="showSection('dashboard')">
                    <i class="fa-solid fa-chart-pie"></i> <span>Özet</span>
                </li>
                <li onclick="showSection('posts'); if(window.fetchPosts) window.fetchPosts();">
                    <i class="fa-solid fa-layer-group"></i> <span>Yazılar</span>
                </li>
                <li onclick="showSection('new-post')">
                    <i class="fa-solid fa-pen-to-square"></i> <span>Yeni Yazı</span>
                </li>
                <li onclick="showSection('tools-manager')">
                    <i class="fa-solid fa-toolbox"></i> <span>Araçlar</span>
                </li>
                <li onclick="showSection('pages-manager')">
                    <i class="fa-solid fa-file-code"></i> <span>Sayfalar</span>
                </li>
                <li onclick="showSection('settings')">
                    <i class="fa-solid fa-gear"></i> <span>Ayarlar</span>
                </li>
            </ul>

            <div class="sidebar-footer">
                <a href="index.html" class="btn-logout" target="_blank">
                    <i class="fa-solid fa-arrow-up-right-from-square"></i> Siteyi Görüntüle
                </a>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="admin-content">

            <!-- HEADER -->
            <header class="admin-header glass">
                <div class="header-left">
                    <button class="mobile-menu-btn hidden-lg" onclick="toggleSidebar()"><i class="fa-solid fa-bars"></i></button>
                    <h3 id="page-title-display">Kontrol Paneli</h3>
                </div>

                <div class="header-right">
                    <div class="user-info" onclick="toggleProfileMenu()" id="user-profile-trigger">
                        <div class="text-right">
                            <span class="user-name" id="display-name">Yükleniyor...</span>
                            <small class="user-role">Süper Yönetici</small>
                        </div>
                        <img src="https://ui-avatars.com/api/?name=Admin&background=3b82f6&color=fff" alt="Admin" id="user-avatar">
                        
                        <!-- Dropdown -->
                        <div class="profile-dropdown glass" id="profile-dropdown">
                            <a href="#" onclick="showSection('settings')"><i class="fa-solid fa-sliders"></i> Ayarlar</a>
                            <a href="#" onclick="logout()" class="dropdown-logout"><i class="fa-solid fa-right-from-bracket"></i> Çıkış Yap</a>
                        </div>
                    </div>
                </div>
            </header>

            <!-- 1. DASHBOARD -->
            <section id="dashboard" class="admin-section active">
                <div class="stats-grid">
                    <div class="stat-card glass">
                        <div class="stat-icon icon-blue"><i class="fa-solid fa-file-lines"></i></div>
                        <div class="stat-info">
                            <h4>Toplam Yazı</h4>
                            <span id="total-posts-count" class="counter">...</span>
                        </div>
                    </div>
                    <div class="stat-card glass">
                        <div class="stat-icon icon-green"><i class="fa-solid fa-layer-group"></i></div>
                        <div class="stat-info">
                            <h4>Kategoriler</h4>
                            <span id="total-cats-count" class="counter">...</span>
                        </div>
                    </div>
                    <div class="stat-card glass">
                        <div class="stat-icon icon-purple"><i class="fa-solid fa-database"></i></div>
                        <div class="stat-info">
                            <h4>Veritabanı</h4>
                            <span class="status-ok">Bağlı (Google Sheets)</span>
                        </div>
                    </div>
                </div>
            </section>

            <!-- 2. POSTS LIST -->
            <section id="posts" class="admin-section">
                <div class="section-top">
                    <div class="section-title">
                        <h2>Tüm İçerikler</h2>
                        <p class="section-subtitle">Blog yazılarınızı buradan yönetebilirsiniz.</p>
                    </div>
                    <div class="actions-right">
                        <div class="search-box">
                            <i class="fa-solid fa-search"></i>
                            <input type="text" id="search-posts" placeholder="Yazı ara..." class="search-input">
                        </div>
                        <button onclick="showSection('new-post')" class="btn-primary"><i class="fa-solid fa-plus"></i> Yeni Ekle</button>
                    </div>
                </div>
                
                <div id="post-list-container" class="table-responsive glass">
                    <p style="text-align: center; padding: 40px; color: #94a3b8;">Veriler yükleniyor...</p>
                </div>
            </section>

            <!-- 3. NEW POST EDITOR -->
            <section id="new-post" class="admin-section">
                <div class="editor-wrapper glass">
                    <div class="form-header">
                        <h2>İçerik Editörü</h2>
                    </div>
                    
                    <form id="add-post-form" onsubmit="return false;">
                        <div class="form-grid">
                            <div class="form-group span-2">
                                <label>Yazı Başlığı</label>
                                <input type="text" id="post-title" placeholder="Etkileyici bir başlık giriniz..." required>
                            </div>
                            <div class="form-group">
                                <label>Tarih</label>
                                <input type="date" id="post-date">
                            </div>
                        </div>
                        
                        <div class="form-grid">
                            <div class="form-group">
                                <label>Kategori</label>
                                <div class="input-with-btn">
                                    <select id="post-category"></select>
                                    <button type="button" class="btn-icon-small" id="add-cat-btn" onclick="addNewCategory()" title="Yeni Kategori"><i class="fa-solid fa-plus"></i></button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Okuma Süresi</label>
                                <input type="text" id="read-time" placeholder="Otomatik hesaplanır" readonly class="readonly-input">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Kapak Görseli (URL)</label>
                            <input type="text" id="post-image" placeholder="https://ornek-resim.com/gorsel.jpg">
                        </div>

                        <div class="form-group">
                            <label>Özet</label>
                            <textarea id="post-desc" rows="2" placeholder="Yazının kısa bir özeti..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label>İçerik</label>
                            <div id="editor-container"></div>
                        </div>

                        <div class="form-group">
                            <label>Etiketler</label>
                            <input type="text" id="tags-input" placeholder="teknoloji, yazılım, ipucu (virgülle ayırın)">
                        </div>

                        <div class="form-group checkbox-wrapper">
                            <input type="checkbox" id="post-featured">
                            <label for="post-featured">Bu yazıyı <b>Öne Çıkanlar</b> listesine ekle</label>
                        </div>

                        <div class="form-footer">
                            <button type="button" class="btn-secondary">Taslak Olarak Kaydet</button>
                            <button type="button" class="btn-primary" onclick="savePost()">Yayınla</button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- 4. TOOLS MANAGER -->
            <section id="tools-manager" class="admin-section">
                <div class="settings-container glass">
                    <div class="section-top"><h2>Araç Yönetimi</h2></div>
                    <div class="add-tool-card glass">
                        <div class="form-grid-3">
                            <input type="text" id="tool-title" placeholder="Araç Adı">
                            <input type="text" id="tool-icon" placeholder="İkon Sınıfı (örn: fa-solid fa-calculator)">
                            <input type="text" id="tool-link" placeholder="Link (örn: araclar/hesapla.html)">
                        </div>
                        <button type="button" onclick="addTool()" class="btn-primary full-width mt-3">Aracı Ekle</button>
                    </div>
                    <div class="table-responsive mt-4">
                        <table class="posts-table"><tbody id="tools-table-body"></tbody></table>
                    </div>
                </div>
            </section>

            <!-- 5. PAGES MANAGER -->
            <section id="pages-manager" class="admin-section">
                <div class="section-top">
                    <h2>Sabit Sayfalar</h2>
                    <button onclick="openNewPageEditor()" class="btn-primary">Sayfa Oluştur</button>
                </div>
                <div class="table-responsive glass">
                    <table class="posts-table"><tbody id="pages-table-body"></tbody></table>
                </div>
            </section>

            <!-- 6. PAGE EDITOR (Detail) -->
            <section id="page-editor" class="admin-section">
                <div class="editor-wrapper glass">
                    <div class="form-header">
                        <h2 id="page-form-title">Sayfa Düzenle</h2>
                        <button onclick="showSection('pages-manager')" class="btn-secondary">Vazgeç</button>
                    </div>
                    <div class="form-group">
                        <label>Sayfa Başlığı</label>
                        <input type="text" id="page-title">
                    </div>
                    <div class="form-group">
                        <label>HTML Kod</label>
                        <textarea id="page-content" class="code-editor" rows="20"></textarea>
                    </div>
                    <button onclick="savePage()" id="btn-save-page" class="btn-primary full-width">Kaydet</button>
                </div>
            </section>

            <!-- 7. SETTINGS -->
            <section id="settings" class="admin-section">
                <div class="settings-container glass">
                    <h2 class="text-center mb-4">Sistem Ayarları</h2>
                    
                    <div class="settings-card" id="settings-section">
                        <h3 class="card-title">Yönetici Bilgileri</h3>
                        <p class="card-desc">Giriş bilgilerinizi buradan güncelleyebilirsiniz.</p>
                        
                        <div class="form-group">
                            <label>Mevcut Kullanıcı Adı</label>
                            <input class="settings-input" id="old-user" type="text">
                        </div>
                        
                        <div class="form-group">
                            <label>Mevcut Şifre</label>
                            <input class="settings-input" id="old-pass" type="password">
                        </div>
                        
                        <hr class="settings-divider">
                        
                        <div class="form-group">
                            <label class="highlight">Yeni Kullanıcı Adı</label>
                            <input class="settings-input" id="new-user" type="text">
                        </div>
                        
                        <div class="form-group">
                            <label class="highlight">Yeni Şifre</label>
                            <input class="settings-input" id="new-pass" type="password">
                        </div>
                        
                        <button onclick="updateAdminCredentials()" class="btn-primary full-width mt-3">
                            <i class="fa-solid fa-floppy-disk"></i> Bilgileri Güncelle
                        </button>
                        
                        <p class="info-text">
                            <i class="fa-solid fa-circle-info"></i> Değişiklikler Google Sheets veritabanına anında işlenir.
                        </p>
                    </div>
                </div>
            </section>

        </main>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    
    <!-- Helpers -->
    <script>
        // Editör sekmesi köprüsü
        window.switchToEditorTab = function() {
            if(typeof showSection === 'function') {
                showSection('new-post');
            }
        };
        
        // Mobil Sidebar Toggle
        function toggleSidebar() {
            document.querySelector('.admin-sidebar').classList.toggle('show');
        }
    </script>

    <!-- Admin Logic -->
    <script src="admin.js"></script>        
    <script src="admin-posts.js"></script> 
    <script src="admin-tools.js"></script>
    <script src="admin-pages.js"></script>

</body>
</html>
